{
    $join: [
		=$,
		{
			portrait: { if: =view.width, less-than: =view.height },
			landscape: { if: =view.width, more-than: =view.height },
			
			aspect: {
				$divide: [
					{$max: [=device.height, =device.width] },
					{$min: [=device.height, =device.width] }
				]
			},

			standard: { 
				if: { 
					$divide: [
						{$max: [=device.height, =device.width] },
						{$min: [=device.height, =device.width] }
					]					
				},
				at-most: 1.4 
			},
			widescreen: { 
				if: { 
					$divide: [
						{$max: [=device.height, =device.width] },
						{$min: [=device.height, =device.width] }
					]					
				},
				at-least: 1.4 
			},

			scale: {
				dpi: { $divide: [=device.dpi, 132] },
				
				pagex: { if: =view.width, more-than: 480, then: {
					if: =view.width, 
					less-than: =view.height,
					then: { $divide: [=view.width, 768] },
					else: { $divide: [=view.width, 1024] }
				}, else: 1},	
						
				pagey: { if: =view.width, more-than: 480, then: {
					if: =view.width, 
					less-than: =view.height,
					then: { $divide: [=view.height, 876] },
					else: { $divide: [=view.height, 620] }
				}, else: 1},

				phone:  { if: =view.width, at-most: 480 },
				tablet: { if: =view.width, more-than: 480 }, 

				small: { if: =device.size, less-than: 8.8 },
				large: { if: =device.size, more-than: 8.8 },
								
				headlines: { if: =device.size, less-than: 8.8, then: true, else: false }
			},
			show_message: { 
				if: =device.platform, 
				equals: "Android", 
				then: {
					if: {$add: [0,
                   				{$join: [
				                        {$substr: [=app.version, 0, 1]},
				                        {$substr: [=app.version, 2, 1]}
			                ]}]}, 
					less-than: 14,
					then: true,
					else: false					
				},
				else: false
			},
			justify: { if-any: [
						{if: =device.size, less-than: 8.8, then: true, else: false}, 
						{if: =issue.edition, equals: "germany", then: true, else: false}
					], then: left, else: justify },
			extents: {
							if: =device.size, less-than: 8.8, then: {
								comment: "divide the headline em width by view em width,",
								comment: "where on average, each character takes up 0.5 em.",
								comment: "and the view em width is the view pixel width divided by headline pixel height.",
								comment: "the magic numbers here are half the font size.",
								huge :  {$divide:[{$multiply:[{$count:[=article.headline]}, 37]}, =view.width]},
								big :   {$divide:[{$multiply:[{$count:[=article.headline]}, 28]}, =view.width]},
								large:  {$divide:[{$multiply:[{$count:[=article.headline]}, 20]}, =view.width]},
								medium:  {$divide:[{$multiply:[{$count:[=article.headline]}, 18]}, =view.width]},
								deco:  {$divide:[{$multiply:[{$count:[=article.headline]}, 12]}, =view.width]}
							}
						},
			ad: {
				prefix: { $join: [
					{ $switch: [ =issue.edition, 
						{ if: =article.headline, ends-with: "\u200a", then: "asia" },
						{ if: =article.headline, ends-with: "\u2009", then: "europe" },
					"us"] },
					".",
					{ $switch: [
						{ if: =device.platform, equals: iOS, then: ipad },
						{ if: =device.platform, equals: Android, then: honeycomb },
						"default"
					] },
					".wsj.com/",
					{ $switch: [
						{ if: =page.section, equals: FRONT_SECTION, then: 
							{ if: =article.frompage, equals: 1, then: frontpage, else: front }
						},
						{ if: =page.section, equals: OPINION, then: opinion },
						{ if: =page.section, equals: MARKETPLACE, then: marketplace },
						{ if: =page.section, equals: MONEY_AND_INVESTING, then: money },
						{ if: =page.section, equals: WEEKEND_JOURNAL, then: weekendjournal },
						{ if: =page.section, equals: FRIDAY_JOURNAL, then: fridayjournal },
						{ if: =page.section, equals: PERSONAL_JOURNAL, then: personaljournal },
						{ if: =page.section, equals: THE_JOURNAL_REPORT, then: journalreport },
						{ if: =page.section, equals: WHATS_NEWS, then: whatsnews },
						{ if: =page.section, equals: NEW_YORK, then: greaterny },
						{ if: =page.section, equals: BUSINESS_AND_FINANCE, then: businessfinance },
						{ if: =page.section, equals: REVIEW, then: review },
						{ if: =page.section, equals: OFF_DUTY, then: offduty },
						{ if: =page.section, equals: CAMPAIGN, then: campaign },
						{ if: =page.section, equals: WSJ_MAGAZINE, then: magazine },
						{ if: =page.section, equals: SPECIAL_REPORT, then: specialreport },	
						{ if: =page.section, equals: EUROPE, then: europe },	
						{ if: =page.section, equals: ASIA, then: asia },	
						{ if: =page.section, equals: LIFE_AND_STYLE, then: lifeandstyle },	
						{ if: =page.section, equals: HONG_KONG, then: hongkong },	
						{ if: =page.section, equals: DEUTSCHLAND, then: deutschland },	
						{ if: =page.section, equals: ANALYSE, then: analyse },	
						{ if: =page.section, equals: WIRTSCHAFT_AND_FINANZEN, then: wirtschaft },	
						{ if: =page.section, equals: SEITE_EINS, then: 
							{ if: =article.frompage, equals: 1, then: aufmacher, else: seiteeins }
						},
						"default"
					] },
					"/"					
				] }
			}			
		}
	]	

}