{
    $join: [
		=$,
		{
			portrait: { if: =view.width, less-than: =view.height },
			landscape: { if: =view.width, more-than: =view.height },

			scale: {
				dpi: { $divide: [=device.dpi, 132] },
				text: { if-all: [
					{ if: =device.platform, equals: Android, then: true, else: false },
					{ if: =device.dpi, at-least: 170, then: true, else: false }
				], then: { $divide: [=device.dpi, 153] }, else: 1},
				pagex: { if: =view.width, more-than: 480, then: {
					if: =view.width,
					less-than: =view.height,
					then: { $divide: [=view.width, 768] },
					else: { $divide: [=view.width, 1024] }
				}, else: 1},

				pagey: { if: =view.width, more-than: 480, then: {
					if: =view.width,
					less-than: =view.height,
					then: { $divide: [=view.height, 1024] },
					else: { $divide: [=view.height, 768] }
				}, else: 1},

				phone: { if: =app.idiom, equals: "phone", then:true, else:false },
				tablet: { if: =app.idiom, equals: "tablet" },

				small: { if: =device.size, less-than: 8.8 },
				large: { if: =device.size, more-than: 8.8 },
				headlines: { if-any: [
							{if: =device.size, less-than: 8.8, then: true, else: false},
							{if: =issue.type, equals: "NOW", then: true, else: false}
						], then: true, else: false }

			},


			justify: { if-any: [
						{if: =device.size, less-than: 8.8, then: true, else: false},
						{if: =issue.edition, equals: "germany", then: true, else: false}
					], then: left, else: justify },
			extents: {
							if-any: [
								{if: =device.size, less-than: 8.8, then: true, else: false},
								{if: =issue.type, equals: "NOW", then: true, else: false}
							],
							 then: {
								comment: "divide the headline em width by view em width,",
								comment: "where on average, each character takes up 0.5 em.",
								comment: "and the view em width is the view pixel width divided by headline pixel height.",
								comment: "the magic numbers here are half the font size.",
								huge :  {$divide:[{$multiply:[{$count:[=article.headline]}, 34]}, =view.width]},
								big :   {$divide:[{$multiply:[{$count:[=article.headline]}, 26]}, =view.width]},
								large:  {$divide:[{$multiply:[{$count:[=article.headline]}, 18]}, =view.width]},
								medium:  {$divide:[{$multiply:[{$count:[=article.headline]}, 15]}, =view.width]},
								deco:  {$divide:[{$multiply:[{$count:[=article.headline]}, 11]}, =view.width]}
							}
						},

			media: {
				width: {if: =page.hasmedia, then: =article.media[page.number].width, else:0} ,
				height: {if: =page.hasmedia, then: =article.media[page.number].height, else:0} ,
				aspect: {if: =page.hasmedia, then: {$divide:[=article.media[page.number].width, =article.media[page.number].height]}, else:0}

			},

			text: {
				indent: 14,
				overflow: "..."
			},

			color: {
				tint: { if-all: [
					{ if: =app.idiom, equals: "tablet" },
					{ if: =issue.type, equals: "NOW" }
				], then: "#E9F5FE" }
			},

			size: {
				if: =app.idiom,
				equals: "phone",
				then: {
					continuation_height_normal: 62,
					continuation_height_large: 160,
					continuation_height_strap: 176
				},
				else: {

				}
			},

			ad: {
				prefix: { $join: [
					{ $switch: [
						{ if: =device.model, starts-with: iPad, then: ipad },
						{ if: =device.model, starts-with: iPhone, then: iphone },
						{ if: =device.model, starts-with: iPod, then: iphone },
						{ if: =device.platform, equals: Android, then: honeycomb },
						"default"
					] },
                    ".",
                    { $switch: [ =issue.edition,
                      { if: =article.headline, ends-with: "\u200a", then: "asia" },
                      { if: =article.headline, ends-with: "\u2009", then: "europe" },
                    "us"] },
                    ".wsj.app/",
					{ $switch: [
						{ if: =page.section, equals: FRONT_SECTION, then:
							{ if: =article.frompage, equals: 1, then: frontpage, else: front }
						},
						{ if: =page.section, equals: OPINION, then: opinion },
						{ if: =page.section, equals: MARKETPLACE, then: marketplace },
						{ if: =page.section, equals: MONEY_AND_INVESTING, then: money },
						{ if: =page.section, equals: WEEKEND_JOURNAL, then: weekendjournal },
						{ if: =page.section, equals: FRIDAY_JOURNAL, then: fridayjournal },
						{ if: =page.section, equals: ARENA, then: arena },
						{ if: =page.section, equals: PERSONAL_JOURNAL, then: personaljournal },
						{ if: =page.section, equals: JOURNAL_REPORT, then: journalreport },
						{ if: =page.section, equals: WHATS_NEWS, then: whatsnews },
						{ if: =page.section, equals: NEW_YORK, then: greaterny },
						{ if: =page.section, equals: BUSINESS_AND_FINANCE, then: businessfinance },
						{ if: =page.section, equals: REVIEW, then: review },
						{ if: =page.section, equals: OFF_DUTY, then: offduty },
						{ if: =page.section, equals: CAMPAIGN, then: campaign },
						{ if: =page.section, equals: WSJ_MAGAZINE, then: magazine },
						{ if: =page.section, equals: SPECIAL_REPORT, then: specialreport },
						{ if: =page.section, equals: SPECIAL_REPORT_TWO, then: specialreporttwo },
						{ if: =page.section, equals: EUROPE, then: europe },
						{ if: =page.section, equals: ASIA, then: asia },
						{ if: =page.section, equals: LIFE_AND_STYLE, then: lifeandstyle },
						{ if: =page.section, equals: MANSION, then: realestate },
						{ if: =page.section, equals: HONG_KONG, then: hongkong },
						{ if: =page.section, equals: DEUTSCHLAND, then: deutschland },
						{ if: =page.section, equals: ANALYSE, then: analyse },
						{ if: =page.section, equals: WIRTSCHAFT_AND_FINANZEN, then: wirtschaft },
						{ if: =page.section, equals: UNTERNEHMEN, then: unternehmen },
						{ if: =page.section, equals: INTERNATIONAL, then: international },
						{ if: =page.section, equals: TECHNOLOGIE, then: technologie },
						{ if: =page.section, equals: SEITE_EINS, then:
							{ if: =article.frompage, equals: 1, then: aufmacher, else: seiteeins }
						},
						{ if: =page.section, equals: JAPAN_AND_WORLD, then: japan },
						{ if: =page.section, equals: LIFESTYLE, then: lifestyle },
						{ if: =page.section, equals: BUSINESS_AND_MARKETS, then: businessmarkets },
						{ if: =page.section, equals: BUSINESS_AND_ECONOMY, then: businesseconomy },
						{ if: =page.section, equals: WSJ_MONEY, then: wsjmoney },
						{ if: =page.section, equals: SAVED, then: saved },
						{ if: =page.section, equals: TOP_NEWS, then: topnews },
						{ if: =page.section, equals: WORLD, then: world },
						{ if: =page.section, equals: BUSINESS, then: business },
						{ if: =page.section, equals: TECHNOLOGY, then: technology },
						{ if: =page.section, equals: TECH, then: technology },
						{ if: =page.section, equals: MARKETS, then: markets },
						{ if: =page.section, equals: LIFE_AND_CULTURE, then: lifeandculture },
						{ if: =page.section, equals: US, then: us },

						"default"
					] }
				] }
			}
		}
	]

}
